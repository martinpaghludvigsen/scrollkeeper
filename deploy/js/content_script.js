var totalScrolled=localStorage.totalScrolled?parseInt(localStorage.totalScrolled):0;var lastScrolled=0;var scrollThreshold=250;var sending=false;var windowOpen=false;var theTimeout;chrome.extension.onMessage.addListener(function(c,b,a){console.log(c);window.clearTimeout(theTimeout);windowOpen=true;if(c.distanceReceived){sending=false;totalScrolled-=c.distanceReceived;localStorage.totalScrolled=totalScrolled}else{if(c.greeting){if(totalScrolled>scrollThreshold){theTimeout=setTimeout(noWindowConnection,250);chrome.extension.sendMessage({totalScrolled:totalScrolled})}}else{}}});window.onscroll=doScroll;function doScroll(a){var c=window.pageYOffset;var b=Math.abs(c-lastScrolled);totalScrolled+=b;if(totalScrolled>scrollThreshold&&!sending&&windowOpen){sending=true;theTimeout=setTimeout(noWindowConnection,250);chrome.extension.sendMessage({totalScrolled:totalScrolled})}lastScrolled=c;localStorage.totalScrolled=totalScrolled}function noWindowConnection(){windowOpen=false;sending=false};